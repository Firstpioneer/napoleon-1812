import{f as b,x as $,y as ct,h as dt,i as ut,c as x,j as a,k as I,a as pt,t as c,n as O,w as vt,r as mt,z as ht,F as ft,p as gt,A as _t,E as kt,q as yt,o as w,l as bt}from"./vendor-jiwSjSMn.js";import{s as U,l as D,a as xt,m as V,b as q,c as G,d as wt}from"./d3-2roUVgtI.js";import{L as _}from"./leaflet-CwTwPtEk.js";import{n as T,a as z,t as N,s as Ct}from"./campaignData-BWYJ6KzS.js";import{k as X}from"./battlesData-cczryqpl.js";import{_ as Dt}from"./index-CJCr3d_v.js";const Tt={class:"dashboard-page"},Mt={class:"stats-header"},St={class:"stat-card"},At={class:"stat-value"},It={class:"stat-card"},zt={class:"stat-value highlight-loss"},Bt={class:"stat-card"},$t={class:"stat-card"},Nt={class:"stat-value"},Rt={class:"stat-card"},Et={class:"stat-value"},Lt={class:"main-content"},Ft={class:"left-panel"},Pt={class:"map-container"},Vt={class:"hover-title"},jt={class:"hover-date"},Ht={class:"hover-stat"},Wt={key:0,class:"hover-stat"},Zt={class:"right-panel"},Ot={class:"battles-list"},Ut=["onClick","onMouseenter"],qt={class:"battle-icon"},Gt={class:"battle-info"},Xt={class:"battle-name"},Jt={class:"battle-date"},Kt={class:"battle-troops"},Qt={class:"bottom-panel"},Yt={class:"timeline-control"},ta=["max"],aa={class:"timeline-date"},ea={class:"modal-content"},sa={class:"modal-subtitle"},oa={class:"modal-overview"},na={class:"modal-stats"},la={class:"modal-stat"},ra={class:"stat-value"},ia={class:"modal-stat"},ca={class:"stat-value"},da={key:0,class:"modal-stat"},ua={class:"stat-value loss"},pa={key:1,class:"modal-stat"},va={class:"stat-value loss"},ma={__name:"DashboardPage",setup(ha){const j=b(null),R=b(null),E=b(null),p=b(0),M=b(!1),u=b(null),f=b(null);b(null);let v=null,S=null,m=null,g=null,A={battles:[],progressMarker:null};const k=$(()=>{const t=T.map(o=>({...o,phase:"advance"})),e=z.slice(1).map(o=>({...o,phase:"retreat"}));return[...t,...e]}),J=$(()=>X.filter(t=>["battle","major_battle","siege"].includes(t.type))),C=$(()=>{const t=k.value[p.value];if(!t)return{troops:422e3,temp:null,day:1,phase:"è¿›æ”»"};const e=new Date("1812-06-24"),o=new Date(t.date),s=Math.floor((o-e)/(1e3*60*60*24))+1,n=N.find(d=>d.date===t.date)||N.reduce((d,l)=>{const r=new Date(l.date),i=new Date(t.date);return r<=i?l:d},N[0]);return{troops:t.survivors,temp:(n==null?void 0:n.temp)??null,day:s,phase:t.phase==="advance"?"è¿›æ”»":"æ’¤é€€"}}),K=$(()=>{const t=k.value[p.value];return(t==null?void 0:t.date)||"1812-06-24"});function y(t){return t>=1e3?Math.round(t/1e3)+"k":t}function H(t){return{battle:"âš”ï¸",major_battle:"ğŸ”¥",siege:"ğŸ°",city:"ğŸ›ï¸",start:"ğŸš©",end:"ğŸ",event:"ğŸ“",disaster:"ğŸ’€"}[t]||"ğŸ“"}function Q(){v=_.map(j.value,{center:[54.5,30],zoom:5,minZoom:4,maxZoom:10,zoomControl:!1,attributionControl:!1}),_.tileLayer("https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:19}).addTo(v),Y(),tt(),at()}function Y(){const t=T[0].survivors;for(let s=0;s<T.length-1;s++){const n=T[s],d=T[s+1],l=Math.max(2,n.survivors/t*10);_.polyline([[n.lat,n.lon],[d.lat,d.lon]],{color:"#D4A373",weight:l,opacity:.8,lineCap:"round"}).addTo(v)}const e=z[0].survivors;for(let s=0;s<z.length-1;s++){const n=z[s],d=z[s+1],l=Math.max(1.5,n.survivors/e*6);_.polyline([[n.lat,n.lon],[d.lat,d.lon]],{color:"#2D2D2D",weight:l,opacity:.9,lineCap:"round"}).addTo(v)}const o=Ct.map(s=>[s.lat,s.lon]);_.polyline(o,{color:"#2A9D8F",weight:2,opacity:.6,dashArray:"8, 4"}).addTo(v)}function tt(){X.forEach(t=>{const e=_.divIcon({className:"battle-marker",html:`<span class="marker-icon">${H(t.type)}</span>`,iconSize:[24,24],iconAnchor:[12,12]}),o=_.marker([t.location.lat,t.location.lon],{icon:e}).addTo(v).on("click",()=>Z(t));o.bindTooltip(t.title,{permanent:!1,direction:"top",className:"battle-tooltip"}),A.battles.push({marker:o,battle:t})})}function at(){const t=_.divIcon({className:"progress-marker",html:'<div class="marker-dot"></div>',iconSize:[20,20],iconAnchor:[10,10]});A.progressMarker=_.marker([T[0].lat,T[0].lon],{icon:t,zIndexOffset:1e3}).addTo(v)}function W(){const t=k.value[p.value];t&&A.progressMarker&&A.progressMarker.setLatLng([t.lat,t.lon])}function et(){const t=R.value,e=t.clientWidth,o=t.clientHeight,s={top:20,right:20,bottom:30,left:50};m=U(t).append("svg").attr("width",e).attr("height",o);const n=k.value,d=D().domain([0,n.length-1]).range([s.left,e-s.right]),l=D().domain([0,45e4]).range([o-s.bottom,s.top]),r=xt().x((h,P)=>d(P)).y0(o-s.bottom).y1(h=>l(h.survivors)).curve(V),i=m.append("defs").append("linearGradient").attr("id","troops-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");i.append("stop").attr("offset","0%").attr("stop-color","#D4A373").attr("stop-opacity",.8),i.append("stop").attr("offset","100%").attr("stop-color","#D4A373").attr("stop-opacity",.1),m.append("path").datum(n).attr("fill","url(#troops-gradient)").attr("d",r);const B=q().x((h,P)=>d(P)).y(h=>l(h.survivors)).curve(V);m.append("path").datum(n).attr("fill","none").attr("stroke","#D4A373").attr("stroke-width",2).attr("d",B),m.append("g").attr("transform",`translate(${s.left}, 0)`).call(G(l).ticks(5).tickFormat(h=>h/1e3+"k")).attr("color","rgba(255,255,255,0.5)"),m.append("line").attr("class","indicator-line").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),m.append("circle").attr("class","indicator-dot").attr("r",6).attr("fill","#D4A373").attr("stroke","#fff").attr("stroke-width",2),L()}function L(){if(!m)return;const t=R.value,e=t.clientWidth,o=t.clientHeight,s={top:20,right:20,bottom:30,left:50},n=k.value,d=D().domain([0,n.length-1]).range([s.left,e-s.right]),l=D().domain([0,45e4]).range([o-s.bottom,s.top]),r=d(p.value),i=l(n[p.value].survivors);m.select(".indicator-line").attr("x1",r).attr("y1",s.top).attr("x2",r).attr("y2",o-s.bottom),m.select(".indicator-dot").attr("cx",r).attr("cy",i)}function st(){const t=E.value,e=t.clientWidth,o=t.clientHeight,s={top:10,right:30,bottom:25,left:50};g=U(t).append("svg").attr("width",e).attr("height",o);const n=N,d=D().domain([24,38]).range([s.left,e-s.right]),l=D().domain([-40,30]).range([o-s.bottom,s.top]);g.append("line").attr("x1",s.left).attr("x2",e-s.right).attr("y1",l(0)).attr("y2",l(0)).attr("stroke","rgba(255,255,255,0.3)").attr("stroke-dasharray","4,4");const r=q().x(i=>d(i.lon)).y(i=>l(i.temp)).curve(V);g.append("path").datum(n).attr("fill","none").attr("stroke","#4A90D9").attr("stroke-width",2).attr("d",r),g.selectAll(".temp-dot").data(n).enter().append("circle").attr("class","temp-dot").attr("cx",i=>d(i.lon)).attr("cy",i=>l(i.temp)).attr("r",4).attr("fill",i=>i.temp<0?"#4A90D9":"#E67E22"),g.append("g").attr("transform",`translate(0, ${o-s.bottom})`).call(wt(d).ticks(7).tickFormat(i=>i+"Â°E")).attr("color","rgba(255,255,255,0.5)"),g.append("g").attr("transform",`translate(${s.left}, 0)`).call(G(l).ticks(5).tickFormat(i=>i+"Â°C")).attr("color","rgba(255,255,255,0.5)"),g.append("line").attr("class","temp-indicator").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),F()}function F(){if(!g)return;const t=E.value,e=t.clientWidth,o=t.clientHeight,s={top:10,right:30,bottom:25,left:50},n=k.value[p.value],l=D().domain([24,38]).range([s.left,e-s.right])(n.lon);g.select(".temp-indicator").attr("x1",l).attr("y1",s.top).attr("x2",l).attr("y2",o-s.bottom)}function ot(){M.value=!M.value,M.value?S=setInterval(()=>{p.value<k.value.length-1?p.value++:(M.value=!1,clearInterval(S))},200):clearInterval(S)}function nt(){M.value=!1,clearInterval(S),p.value=0}function lt(){W(),L(),F()}function Z(t){u.value=t,v&&v.flyTo([t.location.lat,t.location.lon],7,{duration:.5})}function rt(t){const e=A.battles.find(o=>o.battle.id===t.id);e&&e.marker.openTooltip()}function it(){A.battles.forEach(t=>t.marker.closeTooltip())}return ct(p,()=>{W(),L(),F()}),dt(()=>{Q(),setTimeout(()=>{et(),st()},100)}),ut(()=>{S&&clearInterval(S),v&&v.remove()}),(t,e)=>{var s,n,d,l;const o=mt("router-link");return w(),x("div",Tt,[a("header",Mt,[a("div",St,[a("div",At,c(y(C.value.troops)),1),e[4]||(e[4]=a("div",{class:"stat-label"},"å½“å‰å…µåŠ›",-1))]),a("div",It,[a("div",zt,"-"+c(y(422e3-C.value.troops)),1),e[5]||(e[5]=a("div",{class:"stat-label"},"ç´¯è®¡æŸå¤±",-1))]),a("div",Bt,[a("div",{class:O(["stat-value",{"highlight-cold":C.value.temp<0}])},c(C.value.temp!==null?C.value.temp+"Â°C":"--"),3),e[6]||(e[6]=a("div",{class:"stat-label"},"æ¸©åº¦",-1))]),a("div",$t,[a("div",Nt,c(C.value.day),1),e[7]||(e[7]=a("div",{class:"stat-label"},"ç¬¬Nå¤©",-1))]),a("div",Rt,[a("div",Et,c(C.value.phase),1),e[8]||(e[8]=a("div",{class:"stat-label"},"é˜¶æ®µ",-1))]),pt(o,{to:"/visualization",class:"nav-link"},{default:vt(()=>[...e[9]||(e[9]=[bt("â† è¿”å›å™äº‹ç‰ˆ",-1)])]),_:1})]),a("div",Lt,[a("aside",Ft,[e[10]||(e[10]=a("div",{class:"panel-title"},"å…µåŠ›å˜åŒ–",-1)),a("div",{class:"troops-chart",ref_key:"troopsChartRef",ref:R},null,512)]),a("main",Pt,[a("div",{id:"dashboard-map",ref_key:"mapRef",ref:j},null,512),f.value?(w(),x("div",{key:0,class:"hover-card",style:ht({left:f.value.x+"px",top:f.value.y+"px"})},[a("div",Vt,c(f.value.city||f.value.event||"è¡Œå†›ä¸­"),1),a("div",jt,c(f.value.date),1),a("div",Ht,"å…µåŠ›: "+c(y(f.value.troops)),1),f.value.temp!==null?(w(),x("div",Wt,"æ¸©åº¦: "+c(f.value.temp)+"Â°C",1)):I("",!0)],4)):I("",!0)]),a("aside",Zt,[e[11]||(e[11]=a("div",{class:"panel-title"},"å…³é”®æˆ˜å½¹",-1)),a("div",Ot,[(w(!0),x(ft,null,gt(J.value,r=>{var i,B;return w(),x("div",{key:r.id,class:O(["battle-item",{active:((i=u.value)==null?void 0:i.id)===r.id,[r.phase]:!0}]),onClick:h=>Z(r),onMouseenter:h=>rt(r),onMouseleave:e[0]||(e[0]=h=>it())},[a("div",qt,c(H(r.type)),1),a("div",Gt,[a("div",Xt,c(r.title),1),a("div",Jt,c(r.date),1)]),a("div",Kt,c(y(((B=r.stats)==null?void 0:B.frenchTroops)||0)),1)],42,Ut)}),128))])])]),a("footer",Qt,[a("div",{class:"temp-chart",ref_key:"tempChartRef",ref:E},null,512),a("div",Yt,[a("button",{class:"control-btn",onClick:ot},c(M.value?"â¸":"â–¶"),1),a("button",{class:"control-btn",onClick:nt},"â®"),_t(a("input",{type:"range",class:"timeline-slider",min:0,max:k.value.length-1,"onUpdate:modelValue":e[1]||(e[1]=r=>p.value=r),onInput:lt},null,40,ta),[[kt,p.value]]),a("span",aa,c(K.value),1)])]),u.value?(w(),x("div",{key:0,class:"battle-modal",onClick:e[3]||(e[3]=yt(r=>u.value=null,["self"]))},[a("div",ea,[a("button",{class:"modal-close",onClick:e[2]||(e[2]=r=>u.value=null)},"Ã—"),a("h2",null,c(u.value.title),1),a("p",sa,c(u.value.titleEn)+" | "+c(u.value.date),1),a("p",oa,c(u.value.overview),1),a("div",na,[a("div",la,[e[12]||(e[12]=a("span",{class:"stat-label"},"æ³•å†›å…µåŠ›",-1)),a("span",ra,c(y(((s=u.value.stats)==null?void 0:s.frenchTroops)||0)),1)]),a("div",ia,[e[13]||(e[13]=a("span",{class:"stat-label"},"ä¿„å†›å…µåŠ›",-1)),a("span",ca,c(y(((n=u.value.stats)==null?void 0:n.russianTroops)||0)),1)]),(d=u.value.stats)!=null&&d.frenchCasualties?(w(),x("div",da,[e[14]||(e[14]=a("span",{class:"stat-label"},"æ³•å†›ä¼¤äº¡",-1)),a("span",ua,c(y(u.value.stats.frenchCasualties)),1)])):I("",!0),(l=u.value.stats)!=null&&l.russianCasualties?(w(),x("div",pa,[e[15]||(e[15]=a("span",{class:"stat-label"},"ä¿„å†›ä¼¤äº¡",-1)),a("span",va,c(y(u.value.stats.russianCasualties)),1)])):I("",!0)])])])):I("",!0)])}}},xa=Dt(ma,[["__scopeId","data-v-22e3795a"]]);export{xa as default};
