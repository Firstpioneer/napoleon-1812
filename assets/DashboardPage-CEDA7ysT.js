import{f as g,k as N,p as $t,l as zt,m as Lt,c as w,h as e,i as $,a as nt,t as c,n as J,C as lt,r as Ft,q as It,x as K,y as rt,j,F as Pt,s as Rt,D as Nt,w as Ht,o as T}from"./vendor-Clkip-va.js";import{s as it,l as B,a as Wt,m as Q,b as ct,c as dt,d as ut,e as Vt}from"./d3-DRGX556f.js";import{L as y}from"./leaflet-CwTwPtEk.js";import{n as D,a as H,t as z,s as jt}from"./campaignData-BWYJ6KzS.js";import{k as pt}from"./battlesData-BLmEpcsS.js";import{_ as Ot}from"./index-sRwKBGqk.js";const Zt={class:"dashboard-page"},Gt={class:"stats-header"},Ut={class:"stat-card"},Xt={class:"stat-value"},qt={class:"stat-card"},Jt={class:"stat-value highlight-loss"},Kt={class:"stat-card"},Qt={class:"stat-card"},Yt={class:"stat-value"},te={class:"stat-card"},ee={class:"stat-value"},ae={class:"main-content"},se={class:"left-panel"},oe={class:"map-container"},ne={class:"hover-title"},le={class:"hover-date"},re={class:"hover-stat"},ie={key:0,class:"hover-stat"},ce={class:"panel-content"},de={key:0,class:"selection-stats"},ue={class:"selection-info"},pe={class:"selection-stat"},ve={class:"value"},he={class:"selection-stat"},me={class:"value troops"},fe={class:"selection-stat"},ge={class:"value troops"},ye={class:"selection-stat"},_e={class:"value loss"},ke={class:"selection-stat"},be={class:"value loss"},xe={key:0,class:"selection-stat"},we={class:"value temp"},Te={class:"panel-title"},Ce={class:"battles-list"},De=["onClick","onMouseenter"],Me={class:"battle-icon"},Se={class:"battle-info"},Be={class:"battle-name"},Ae={class:"battle-date"},Ee={class:"battle-troops"},$e={class:"bottom-panel"},ze={class:"timeline-control"},Le=["max"],Fe={class:"timeline-date"},Ie={class:"modal-content"},Pe={class:"modal-subtitle"},Re={class:"modal-overview"},Ne={class:"modal-stats"},He={class:"modal-stat"},We={class:"stat-value"},Ve={class:"modal-stat"},je={class:"stat-value"},Oe={key:0,class:"modal-stat"},Ze={class:"stat-value loss"},Ge={key:1,class:"modal-stat"},Ue={class:"stat-value loss"},Xe={__name:"DashboardPage",setup(qe){const Y=g(null),O=g(null),W=g(null),_=g(0),L=g(!1),u=g(null),C=g(null);g(null);const v=g(null),Z=g(null),F=g(!1),V=g(!1),tt=g(!1);let k=null,A={advance:[],retreat:[]},M=null,I=null,h=null,m=null,P={battles:[],progressMarker:null};function G(){tt.value=window.innerWidth<=768}const vt=N(()=>tt.value?F.value?"â–²":"â–¼":F.value?"â—€":"â–¶"),S=N(()=>{const a=D.map(n=>({...n,phase:"advance"})),t=H.slice(1).map(n=>({...n,phase:"retreat"}));return[...a,...t]}),ht=N(()=>pt.filter(a=>["battle","major_battle","siege"].includes(a.type))),E=N(()=>{const a=S.value[_.value];if(!a)return{troops:422e3,temp:null,day:1,phase:"è¿›æ”»"};const t=new Date("1812-06-24"),n=new Date(a.date),s=Math.floor((n-t)/(1e3*60*60*24))+1,o=z.find(r=>r.date===a.date)||z.reduce((r,l)=>{const i=new Date(l.date),d=new Date(a.date);return i<=d?l:r},z[0]);return{troops:a.survivors,temp:(o==null?void 0:o.temp)??null,day:s,phase:a.phase==="advance"?"è¿›æ”»":"æ’¤é€€"}}),mt=N(()=>{const a=S.value[_.value];return(a==null?void 0:a.date)||"1812-06-24"});function b(a){return a>=1e3?Math.round(a/1e3)+"k":a}function et(a){return{battle:"âš”ï¸",major_battle:"ğŸ”¥",siege:"ğŸ°",city:"ğŸ›ï¸",start:"ğŸš©",end:"ğŸ",event:"ğŸ“",disaster:"ğŸ’€"}[a]||"ğŸ“"}function ft(){k=y.map(Y.value,{center:[54.5,30],zoom:5,minZoom:4,maxZoom:10,zoomControl:!1,attributionControl:!1}),y.tileLayer("https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:19}).addTo(k),gt(),yt(),_t()}function gt(){const a=D[0].survivors;A={advance:[],retreat:[]};for(let s=0;s<D.length-1;s++){const o=D[s],r=D[s+1],l=Math.max(2,o.survivors/a*10),i=y.polyline([[o.lat,o.lon],[r.lat,r.lon]],{color:"#D4A373",weight:l,opacity:.8,lineCap:"round"}).addTo(k);A.advance.push({segment:i,index:s,start:o,end:r})}const t=H[0].survivors;for(let s=0;s<H.length-1;s++){const o=H[s],r=H[s+1],l=Math.max(1.5,o.survivors/t*6),i=y.polyline([[o.lat,o.lon],[r.lat,r.lon]],{color:"#2D2D2D",weight:l,opacity:.9,lineCap:"round"}).addTo(k);A.retreat.push({segment:i,index:s+D.length-1,start:o,end:r})}const n=jt.map(s=>[s.lat,s.lon]);y.polyline(n,{color:"#2A9D8F",weight:2,opacity:.6,dashArray:"8, 4"}).addTo(k),M=y.layerGroup().addTo(k)}function yt(){pt.forEach(a=>{const t=y.divIcon({className:"battle-marker",html:`<span class="marker-icon">${et(a.type)}</span>`,iconSize:[24,24],iconAnchor:[12,12]}),n=y.marker([a.location.lat,a.location.lon],{icon:t}).addTo(k).on("click",()=>st(a));n.bindTooltip(a.title,{permanent:!1,direction:"top",className:"battle-tooltip"}),P.battles.push({marker:n,battle:a})})}function _t(){const a=y.divIcon({className:"progress-marker",html:'<div class="marker-dot"></div>',iconSize:[20,20],iconAnchor:[10,10]});P.progressMarker=y.marker([D[0].lat,D[0].lon],{icon:a,zIndexOffset:1e3}).addTo(k)}function at(){const a=S.value[_.value];a&&P.progressMarker&&P.progressMarker.setLatLng([a.lat,a.lon])}function kt(){const a=O.value,t=a.clientWidth,n=a.clientHeight,s={top:20,right:20,bottom:30,left:50};h=it(a).append("svg").attr("width",t).attr("height",n);const o=S.value,r=B().domain([0,o.length-1]).range([s.left,t-s.right]),l=B().domain([0,45e4]).range([n-s.bottom,s.top]),i=Wt().x((p,R)=>r(R)).y0(n-s.bottom).y1(p=>l(p.survivors)).curve(Q),d=h.append("defs").append("linearGradient").attr("id","troops-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("stop-color","#D4A373").attr("stop-opacity",.8),d.append("stop").attr("offset","100%").attr("stop-color","#D4A373").attr("stop-opacity",.1),h.append("path").datum(o).attr("class","troops-area").attr("fill","url(#troops-gradient)").attr("d",i);const f=ct().x((p,R)=>r(R)).y(p=>l(p.survivors)).curve(Q);h.append("path").datum(o).attr("class","troops-line").attr("fill","none").attr("stroke","#D4A373").attr("stroke-width",2).attr("d",f),h.append("rect").attr("class","troops-highlight").attr("fill","rgba(212, 163, 115, 0.3)").attr("stroke","#D4A373").attr("stroke-width",2).attr("display","none"),h.append("g").attr("transform",`translate(${s.left}, 0)`).call(dt(l).ticks(5).tickFormat(p=>p/1e3+"k")).attr("color","rgba(255,255,255,0.5)"),h.append("line").attr("class","indicator-line").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),h.append("circle").attr("class","indicator-dot").attr("r",6).attr("fill","#D4A373").attr("stroke","#fff").attr("stroke-width",2);const x=ut().extent([[s.left,s.top],[t-s.right,n-s.bottom]]).on("brush",p=>Mt(p,r,o)).on("end",p=>St(p,r,o));h.append("g").attr("class","troops-brush").call(x),U()}function U(){if(!h)return;const a=O.value,t=a.clientWidth,n=a.clientHeight,s={top:20,right:20,bottom:30,left:50},o=S.value,r=B().domain([0,o.length-1]).range([s.left,t-s.right]),l=B().domain([0,45e4]).range([n-s.bottom,s.top]),i=r(_.value),d=l(o[_.value].survivors);h.select(".indicator-line").attr("x1",i).attr("y1",s.top).attr("x2",i).attr("y2",n-s.bottom),h.select(".indicator-dot").attr("cx",i).attr("cy",d)}function bt(){const a=W.value,t=a.clientWidth,n=a.clientHeight,s={top:10,right:30,bottom:25,left:50};m=it(a).append("svg").attr("width",t).attr("height",n);const o=z,r=B().domain([24,38]).range([s.left,t-s.right]),l=B().domain([-40,30]).range([n-s.bottom,s.top]);m.append("line").attr("x1",s.left).attr("x2",t-s.right).attr("y1",l(0)).attr("y2",l(0)).attr("stroke","rgba(255,255,255,0.3)").attr("stroke-dasharray","4,4");const i=ct().x(d=>r(d.lon)).y(d=>l(d.temp)).curve(Q);m.append("path").datum(o).attr("class","temp-line").attr("fill","none").attr("stroke","#4A90D9").attr("stroke-width",2).attr("d",i),m.append("rect").attr("class","temp-highlight").attr("fill","rgba(74, 144, 217, 0.3)").attr("stroke","#4A90D9").attr("stroke-width",2).attr("display","none"),m.selectAll(".temp-dot").data(o).enter().append("circle").attr("class","temp-dot").attr("cx",d=>r(d.lon)).attr("cy",d=>l(d.temp)).attr("r",4).attr("fill",d=>d.temp<0?"#4A90D9":"#E67E22"),m.append("g").attr("transform",`translate(0, ${n-s.bottom})`).call(Vt(r).ticks(7).tickFormat(d=>d+"Â°E")).attr("color","rgba(255,255,255,0.5)"),m.append("g").attr("transform",`translate(${s.left}, 0)`).call(dt(l).ticks(5).tickFormat(d=>d+"Â°C")).attr("color","rgba(255,255,255,0.5)"),m.append("line").attr("class","temp-indicator").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),m.append("text").attr("class","temp-hint").attr("x",t-s.right-5).attr("y",s.top+12).attr("text-anchor","end").attr("fill","rgba(255,255,255,0.4)").attr("font-size","10px").text("ä»å…µåŠ›å›¾æ¡†é€‰åŒæ­¥"),X()}function X(){if(!m)return;const a=W.value,t=a.clientWidth,n=a.clientHeight,s={top:10,right:30,bottom:25,left:50},o=S.value[_.value],l=B().domain([24,38]).range([s.left,t-s.right])(o.lon);m.select(".temp-indicator").attr("x1",l).attr("y1",s.top).attr("x2",l).attr("y2",n-s.bottom)}function xt(){L.value=!L.value,L.value?I=setInterval(()=>{_.value<S.value.length-1?_.value++:(L.value=!1,clearInterval(I))},200):clearInterval(I)}function wt(){L.value=!1,clearInterval(I),_.value=0}function Tt(){at(),U(),X()}function st(a){u.value=a,k&&k.flyTo([a.location.lat,a.location.lon],7,{duration:.5})}function Ct(a){const t=P.battles.find(n=>n.battle.id===a.id);t&&t.marker.openTooltip()}function Dt(){P.battles.forEach(a=>a.marker.closeTooltip())}function Mt(a,t,n){if(!a.selection)return;const[s,o]=a.selection,r=Math.round(t.invert(s)),l=Math.round(t.invert(o));Z.value={startIdx:r,endIdx:l},ot(r,l,n)}function St(a,t,n){if(!a.selection){q();return}const[s,o]=a.selection,r=Math.max(0,Math.round(t.invert(s))),l=Math.min(n.length-1,Math.round(t.invert(o)));if(r===l){q();return}Z.value={startIdx:r,endIdx:l},Bt(r,l,n),ot(r,l,n),At(r,l,n)}function Bt(a,t,n){const s=n[a],o=n[t],r=n.slice(a,t+1);let l=null,i=null;r.forEach(d=>{const f=z.find(x=>x.date===d.date)||z.reduce((x,p)=>{const R=new Date(p.date),Et=new Date(d.date);return R<=Et?p:x},z[0]);f&&f.temp!==null&&((l===null||f.temp<l)&&(l=f.temp),(i===null||f.temp>i)&&(i=f.temp))}),v.value={startDate:s.date,endDate:o.date,startTroops:s.survivors,endTroops:o.survivors,minTemp:l,maxTemp:i,startIdx:a,endIdx:t}}function q(){v.value=null,Z.value=null,M&&M.clearLayers(),A.advance.forEach(a=>a.segment.setStyle({opacity:.8})),A.retreat.forEach(a=>a.segment.setStyle({opacity:.9})),h&&(h.select(".troops-highlight").attr("display","none"),h.select(".troops-brush").call(ut().move,null)),m&&m.select(".temp-highlight").attr("display","none")}function ot(a,t,n){if(!M)return;M.clearLayers(),A.advance.forEach(o=>{o.index>=a&&o.index<t?o.segment.setStyle({opacity:1}):o.segment.setStyle({opacity:.2})}),D.length-1,A.retreat.forEach(o=>{const r=o.index;r>=a&&r<t?o.segment.setStyle({opacity:1}):o.segment.setStyle({opacity:.2})});const s=[];for(let o=a;o<=t&&o<n.length;o++)s.push([n[o].lat,n[o].lon]);s.length>1&&(y.polyline(s,{color:"#FFD700",weight:6,opacity:.8,lineCap:"round"}).addTo(M),y.circleMarker(s[0],{radius:8,fillColor:"#00FF00",color:"#fff",weight:2,fillOpacity:1}).addTo(M),y.circleMarker(s[s.length-1],{radius:8,fillColor:"#FF4444",color:"#fff",weight:2,fillOpacity:1}).addTo(M))}function At(a,t,n){if(!m)return;const s=W.value,o=s.clientWidth,r=s.clientHeight,l={top:10,right:30,bottom:25,left:50},i=B().domain([24,38]).range([l.left,o-l.right]),d=n[a].lon,f=n[t].lon,x=i(Math.min(d,f)),p=i(Math.max(d,f));m.select(".temp-highlight").attr("x",x).attr("y",l.top).attr("width",Math.max(p-x,4)).attr("height",r-l.top-l.bottom).attr("display","block")}return $t(_,()=>{at(),U(),X()}),zt(()=>{G(),window.addEventListener("resize",G),ft(),setTimeout(()=>{kt(),bt()},100)}),Lt(()=>{window.removeEventListener("resize",G),I&&clearInterval(I),k&&k.remove()}),(a,t)=>{var s,o,r,l;const n=Ft("router-link");return T(),w("div",Zt,[e("header",Gt,[e("div",Ut,[e("div",Xt,c(b(E.value.troops)),1),t[6]||(t[6]=e("div",{class:"stat-label"},"å½“å‰å…µåŠ›",-1))]),e("div",qt,[e("div",Jt,"-"+c(b(422e3-E.value.troops)),1),t[7]||(t[7]=e("div",{class:"stat-label"},"ç´¯è®¡æŸå¤±",-1))]),e("div",Kt,[e("div",{class:J(["stat-value",{"highlight-cold":E.value.temp<0}])},c(E.value.temp!==null?E.value.temp+"Â°C":"--"),3),t[8]||(t[8]=e("div",{class:"stat-label"},"æ¸©åº¦",-1))]),e("div",Qt,[e("div",Yt,c(E.value.day),1),t[9]||(t[9]=e("div",{class:"stat-label"},"ç¬¬Nå¤©",-1))]),e("div",te,[e("div",ee,c(E.value.phase),1),t[10]||(t[10]=e("div",{class:"stat-label"},"é˜¶æ®µ",-1))]),nt(n,{to:"/visualization",class:"nav-link"},{default:lt(()=>[...t[11]||(t[11]=[j("â† è¿”å›å™äº‹ç‰ˆ",-1)])]),_:1})]),e("div",ae,[e("aside",se,[t[12]||(t[12]=e("div",{class:"panel-title"},"å…µåŠ›å˜åŒ–",-1)),e("div",{class:"troops-chart",ref_key:"troopsChartRef",ref:O},null,512)]),e("main",oe,[e("div",{id:"dashboard-map",ref_key:"mapRef",ref:Y},null,512),C.value?(T(),w("div",{key:0,class:"hover-card",style:It({left:C.value.x+"px",top:C.value.y+"px"})},[e("div",ne,c(C.value.city||C.value.event||"è¡Œå†›ä¸­"),1),e("div",le,c(C.value.date),1),e("div",re,"å…µåŠ›: "+c(b(C.value.troops)),1),C.value.temp!==null?(T(),w("div",ie,"æ¸©åº¦: "+c(C.value.temp)+"Â°C",1)):$("",!0)],4)):$("",!0)]),e("aside",{class:J(["right-panel",{collapsed:F.value,hidden:V.value}])},[K(e("button",{class:"panel-toggle-btn",onClick:t[0]||(t[0]=i=>F.value=!F.value)},c(vt.value),513),[[rt,!V.value]]),K(e("div",ce,[v.value?(T(),w("div",de,[e("div",{class:"panel-title"},[t[13]||(t[13]=j(" é€‰åŒºç»Ÿè®¡ ",-1)),e("button",{class:"clear-selection-btn",onClick:q},"æ¸…é™¤")]),e("div",ue,[e("div",pe,[t[14]||(t[14]=e("span",{class:"label"},"æ—¶é—´èŒƒå›´",-1)),e("span",ve,c(v.value.startDate)+" ~ "+c(v.value.endDate),1)]),e("div",he,[t[15]||(t[15]=e("span",{class:"label"},"èµ·å§‹å…µåŠ›",-1)),e("span",me,c(b(v.value.startTroops)),1)]),e("div",fe,[t[16]||(t[16]=e("span",{class:"label"},"ç»“æŸå…µåŠ›",-1)),e("span",ge,c(b(v.value.endTroops)),1)]),e("div",ye,[t[17]||(t[17]=e("span",{class:"label"},"å…µåŠ›æŸå¤±",-1)),e("span",_e,"-"+c(b(v.value.startTroops-v.value.endTroops)),1)]),e("div",ke,[t[18]||(t[18]=e("span",{class:"label"},"æŸå¤±ç‡",-1)),e("span",be,c(((v.value.startTroops-v.value.endTroops)/v.value.startTroops*100).toFixed(1))+"%",1)]),v.value.minTemp!==null?(T(),w("div",xe,[t[19]||(t[19]=e("span",{class:"label"},"æ¸©åº¦èŒƒå›´",-1)),e("span",we,c(v.value.minTemp)+"Â°C ~ "+c(v.value.maxTemp)+"Â°C",1)])):$("",!0)])])):$("",!0),e("div",Te,[t[20]||(t[20]=j(" å…³é”®æˆ˜å½¹ ",-1)),e("button",{class:"close-panel-btn",onClick:t[1]||(t[1]=i=>V.value=!0)},"Ã—")]),e("div",Ce,[(T(!0),w(Pt,null,Rt(ht.value,i=>{var d,f;return T(),w("div",{key:i.id,class:J(["battle-item",{active:((d=u.value)==null?void 0:d.id)===i.id,[i.phase]:!0}]),onClick:x=>st(i),onMouseenter:x=>Ct(i),onMouseleave:t[2]||(t[2]=x=>Dt())},[e("div",Me,c(et(i.type)),1),e("div",Se,[e("div",Be,c(i.title),1),e("div",Ae,c(i.date),1)]),e("div",Ee,c(b(((f=i.stats)==null?void 0:f.frenchTroops)||0)),1)],42,De)}),128))])],512),[[rt,!F.value&&!V.value]])],2)]),e("footer",$e,[e("div",{class:"temp-chart",ref_key:"tempChartRef",ref:W},null,512),e("div",ze,[e("button",{class:"control-btn",onClick:xt},c(L.value?"â¸":"â–¶"),1),e("button",{class:"control-btn",onClick:wt},"â®"),K(e("input",{type:"range",class:"timeline-slider",min:0,max:S.value.length-1,"onUpdate:modelValue":t[3]||(t[3]=i=>_.value=i),onInput:Tt},null,40,Le),[[Nt,_.value]]),e("span",Fe,c(mt.value),1)])]),u.value?(T(),w("div",{key:0,class:"battle-modal",onClick:t[5]||(t[5]=Ht(i=>u.value=null,["self"]))},[e("div",Ie,[e("button",{class:"modal-close",onClick:t[4]||(t[4]=i=>u.value=null)},"Ã—"),e("h2",null,c(u.value.title),1),e("p",Pe,c(u.value.titleEn)+" | "+c(u.value.date),1),e("p",Re,c(u.value.overview),1),e("div",Ne,[e("div",He,[t[21]||(t[21]=e("span",{class:"stat-label"},"æ³•å†›å…µåŠ›",-1)),e("span",We,c(b(((s=u.value.stats)==null?void 0:s.frenchTroops)||0)),1)]),e("div",Ve,[t[22]||(t[22]=e("span",{class:"stat-label"},"ä¿„å†›å…µåŠ›",-1)),e("span",je,c(b(((o=u.value.stats)==null?void 0:o.russianTroops)||0)),1)]),(r=u.value.stats)!=null&&r.frenchCasualties?(T(),w("div",Oe,[t[23]||(t[23]=e("span",{class:"stat-label"},"æ³•å†›ä¼¤äº¡",-1)),e("span",Ze,c(b(u.value.stats.frenchCasualties)),1)])):$("",!0),(l=u.value.stats)!=null&&l.russianCasualties?(T(),w("div",Ge,[t[24]||(t[24]=e("span",{class:"stat-label"},"ä¿„å†›ä¼¤äº¡",-1)),e("span",Ue,c(b(u.value.stats.russianCasualties)),1)])):$("",!0)]),nt(n,{to:`/battle/${u.value.id}`,class:"modal-detail-link"},{default:lt(()=>[...t[25]||(t[25]=[j(" æŸ¥çœ‹è¯¦ç»†ä»‹ç» â†’ ",-1)])]),_:1},8,["to"])])])):$("",!0)])}}},aa=Ot(Xe,[["__scopeId","data-v-89983a1d"]]);export{aa as default};
