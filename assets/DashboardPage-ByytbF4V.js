import{f as x,k as H,p as Ct,l as Dt,m as Mt,c as T,h as a,i as F,a as Y,t as c,n as tt,C as et,r as St,q as Bt,j as G,F as At,s as Et,x as Ft,D as $t,w as zt,o as w}from"./vendor-Clkip-va.js";import{s as at,l as B,a as Lt,m as U,b as st,c as ot,d as nt,e as It}from"./d3-DRGX556f.js";import{L as g}from"./leaflet-CwTwPtEk.js";import{n as D,a as N,t as $,s as Rt}from"./campaignData-BWYJ6KzS.js";import{k as lt}from"./battlesData-BLmEpcsS.js";import{_ as Nt}from"./index-D6N3p2Ma.js";const Pt={class:"dashboard-page"},Ht={class:"stats-header"},Vt={class:"stat-card"},Wt={class:"stat-value"},jt={class:"stat-card"},Ot={class:"stat-value highlight-loss"},Zt={class:"stat-card"},Gt={class:"stat-card"},Ut={class:"stat-value"},Xt={class:"stat-card"},qt={class:"stat-value"},Jt={class:"main-content"},Kt={class:"left-panel"},Qt={class:"map-container"},Yt={class:"hover-title"},te={class:"hover-date"},ee={class:"hover-stat"},ae={key:0,class:"hover-stat"},se={class:"right-panel"},oe={key:0,class:"selection-stats"},ne={class:"selection-info"},le={class:"selection-stat"},re={class:"value"},ie={class:"selection-stat"},ce={class:"value troops"},de={class:"selection-stat"},ue={class:"value troops"},pe={class:"selection-stat"},ve={class:"value loss"},he={class:"selection-stat"},me={class:"value loss"},fe={key:0,class:"selection-stat"},ge={class:"value temp"},ye={class:"battles-list"},_e=["onClick","onMouseenter"],ke={class:"battle-icon"},be={class:"battle-info"},xe={class:"battle-name"},Te={class:"battle-date"},we={class:"battle-troops"},Ce={class:"bottom-panel"},De={class:"timeline-control"},Me=["max"],Se={class:"timeline-date"},Be={class:"modal-content"},Ae={class:"modal-subtitle"},Ee={class:"modal-overview"},Fe={class:"modal-stats"},$e={class:"modal-stat"},ze={class:"stat-value"},Le={class:"modal-stat"},Ie={class:"stat-value"},Re={key:0,class:"modal-stat"},Ne={class:"stat-value loss"},Pe={key:1,class:"modal-stat"},He={class:"stat-value loss"},Ve={__name:"DashboardPage",setup(We){const X=x(null),V=x(null),P=x(null),y=x(0),z=x(!1),u=x(null),C=x(null);x(null);const v=x(null),W=x(null);let _=null,A={advance:[],retreat:[]},M=null,L=null,h=null,m=null,I={battles:[],progressMarker:null};const S=H(()=>{const e=D.map(n=>({...n,phase:"advance"})),t=N.slice(1).map(n=>({...n,phase:"retreat"}));return[...e,...t]}),rt=H(()=>lt.filter(e=>["battle","major_battle","siege"].includes(e.type))),E=H(()=>{const e=S.value[y.value];if(!e)return{troops:422e3,temp:null,day:1,phase:"è¿›æ”»"};const t=new Date("1812-06-24"),n=new Date(e.date),s=Math.floor((n-t)/(1e3*60*60*24))+1,o=$.find(r=>r.date===e.date)||$.reduce((r,l)=>{const i=new Date(l.date),d=new Date(e.date);return i<=d?l:r},$[0]);return{troops:e.survivors,temp:(o==null?void 0:o.temp)??null,day:s,phase:e.phase==="advance"?"è¿›æ”»":"æ’¤é€€"}}),it=H(()=>{const e=S.value[y.value];return(e==null?void 0:e.date)||"1812-06-24"});function k(e){return e>=1e3?Math.round(e/1e3)+"k":e}function q(e){return{battle:"âš”ï¸",major_battle:"ğŸ”¥",siege:"ğŸ°",city:"ğŸ›ï¸",start:"ğŸš©",end:"ğŸ",event:"ğŸ“",disaster:"ğŸ’€"}[e]||"ğŸ“"}function ct(){_=g.map(X.value,{center:[54.5,30],zoom:5,minZoom:4,maxZoom:10,zoomControl:!1,attributionControl:!1}),g.tileLayer("https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png",{subdomains:"abcd",maxZoom:19}).addTo(_),dt(),ut(),pt()}function dt(){const e=D[0].survivors;A={advance:[],retreat:[]};for(let s=0;s<D.length-1;s++){const o=D[s],r=D[s+1],l=Math.max(2,o.survivors/e*10),i=g.polyline([[o.lat,o.lon],[r.lat,r.lon]],{color:"#D4A373",weight:l,opacity:.8,lineCap:"round"}).addTo(_);A.advance.push({segment:i,index:s,start:o,end:r})}const t=N[0].survivors;for(let s=0;s<N.length-1;s++){const o=N[s],r=N[s+1],l=Math.max(1.5,o.survivors/t*6),i=g.polyline([[o.lat,o.lon],[r.lat,r.lon]],{color:"#2D2D2D",weight:l,opacity:.9,lineCap:"round"}).addTo(_);A.retreat.push({segment:i,index:s+D.length-1,start:o,end:r})}const n=Rt.map(s=>[s.lat,s.lon]);g.polyline(n,{color:"#2A9D8F",weight:2,opacity:.6,dashArray:"8, 4"}).addTo(_),M=g.layerGroup().addTo(_)}function ut(){lt.forEach(e=>{const t=g.divIcon({className:"battle-marker",html:`<span class="marker-icon">${q(e.type)}</span>`,iconSize:[24,24],iconAnchor:[12,12]}),n=g.marker([e.location.lat,e.location.lon],{icon:t}).addTo(_).on("click",()=>K(e));n.bindTooltip(e.title,{permanent:!1,direction:"top",className:"battle-tooltip"}),I.battles.push({marker:n,battle:e})})}function pt(){const e=g.divIcon({className:"progress-marker",html:'<div class="marker-dot"></div>',iconSize:[20,20],iconAnchor:[10,10]});I.progressMarker=g.marker([D[0].lat,D[0].lon],{icon:e,zIndexOffset:1e3}).addTo(_)}function J(){const e=S.value[y.value];e&&I.progressMarker&&I.progressMarker.setLatLng([e.lat,e.lon])}function vt(){const e=V.value,t=e.clientWidth,n=e.clientHeight,s={top:20,right:20,bottom:30,left:50};h=at(e).append("svg").attr("width",t).attr("height",n);const o=S.value,r=B().domain([0,o.length-1]).range([s.left,t-s.right]),l=B().domain([0,45e4]).range([n-s.bottom,s.top]),i=Lt().x((p,R)=>r(R)).y0(n-s.bottom).y1(p=>l(p.survivors)).curve(U),d=h.append("defs").append("linearGradient").attr("id","troops-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("stop-color","#D4A373").attr("stop-opacity",.8),d.append("stop").attr("offset","100%").attr("stop-color","#D4A373").attr("stop-opacity",.1),h.append("path").datum(o).attr("class","troops-area").attr("fill","url(#troops-gradient)").attr("d",i);const f=st().x((p,R)=>r(R)).y(p=>l(p.survivors)).curve(U);h.append("path").datum(o).attr("class","troops-line").attr("fill","none").attr("stroke","#D4A373").attr("stroke-width",2).attr("d",f),h.append("rect").attr("class","troops-highlight").attr("fill","rgba(212, 163, 115, 0.3)").attr("stroke","#D4A373").attr("stroke-width",2).attr("display","none"),h.append("g").attr("transform",`translate(${s.left}, 0)`).call(ot(l).ticks(5).tickFormat(p=>p/1e3+"k")).attr("color","rgba(255,255,255,0.5)"),h.append("line").attr("class","indicator-line").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),h.append("circle").attr("class","indicator-dot").attr("r",6).attr("fill","#D4A373").attr("stroke","#fff").attr("stroke-width",2);const b=nt().extent([[s.left,s.top],[t-s.right,n-s.bottom]]).on("brush",p=>kt(p,r,o)).on("end",p=>bt(p,r,o));h.append("g").attr("class","troops-brush").call(b),j()}function j(){if(!h)return;const e=V.value,t=e.clientWidth,n=e.clientHeight,s={top:20,right:20,bottom:30,left:50},o=S.value,r=B().domain([0,o.length-1]).range([s.left,t-s.right]),l=B().domain([0,45e4]).range([n-s.bottom,s.top]),i=r(y.value),d=l(o[y.value].survivors);h.select(".indicator-line").attr("x1",i).attr("y1",s.top).attr("x2",i).attr("y2",n-s.bottom),h.select(".indicator-dot").attr("cx",i).attr("cy",d)}function ht(){const e=P.value,t=e.clientWidth,n=e.clientHeight,s={top:10,right:30,bottom:25,left:50};m=at(e).append("svg").attr("width",t).attr("height",n);const o=$,r=B().domain([24,38]).range([s.left,t-s.right]),l=B().domain([-40,30]).range([n-s.bottom,s.top]);m.append("line").attr("x1",s.left).attr("x2",t-s.right).attr("y1",l(0)).attr("y2",l(0)).attr("stroke","rgba(255,255,255,0.3)").attr("stroke-dasharray","4,4");const i=st().x(d=>r(d.lon)).y(d=>l(d.temp)).curve(U);m.append("path").datum(o).attr("class","temp-line").attr("fill","none").attr("stroke","#4A90D9").attr("stroke-width",2).attr("d",i),m.append("rect").attr("class","temp-highlight").attr("fill","rgba(74, 144, 217, 0.3)").attr("stroke","#4A90D9").attr("stroke-width",2).attr("display","none"),m.selectAll(".temp-dot").data(o).enter().append("circle").attr("class","temp-dot").attr("cx",d=>r(d.lon)).attr("cy",d=>l(d.temp)).attr("r",4).attr("fill",d=>d.temp<0?"#4A90D9":"#E67E22"),m.append("g").attr("transform",`translate(0, ${n-s.bottom})`).call(It(r).ticks(7).tickFormat(d=>d+"Â°E")).attr("color","rgba(255,255,255,0.5)"),m.append("g").attr("transform",`translate(${s.left}, 0)`).call(ot(l).ticks(5).tickFormat(d=>d+"Â°C")).attr("color","rgba(255,255,255,0.5)"),m.append("line").attr("class","temp-indicator").attr("stroke","#fff").attr("stroke-width",1).attr("stroke-dasharray","4,4"),m.append("text").attr("class","temp-hint").attr("x",t-s.right-5).attr("y",s.top+12).attr("text-anchor","end").attr("fill","rgba(255,255,255,0.4)").attr("font-size","10px").text("ä»å…µåŠ›å›¾æ¡†é€‰åŒæ­¥"),O()}function O(){if(!m)return;const e=P.value,t=e.clientWidth,n=e.clientHeight,s={top:10,right:30,bottom:25,left:50},o=S.value[y.value],l=B().domain([24,38]).range([s.left,t-s.right])(o.lon);m.select(".temp-indicator").attr("x1",l).attr("y1",s.top).attr("x2",l).attr("y2",n-s.bottom)}function mt(){z.value=!z.value,z.value?L=setInterval(()=>{y.value<S.value.length-1?y.value++:(z.value=!1,clearInterval(L))},200):clearInterval(L)}function ft(){z.value=!1,clearInterval(L),y.value=0}function gt(){J(),j(),O()}function K(e){u.value=e,_&&_.flyTo([e.location.lat,e.location.lon],7,{duration:.5})}function yt(e){const t=I.battles.find(n=>n.battle.id===e.id);t&&t.marker.openTooltip()}function _t(){I.battles.forEach(e=>e.marker.closeTooltip())}function kt(e,t,n){if(!e.selection)return;const[s,o]=e.selection,r=Math.round(t.invert(s)),l=Math.round(t.invert(o));W.value={startIdx:r,endIdx:l},Q(r,l,n)}function bt(e,t,n){if(!e.selection){Z();return}const[s,o]=e.selection,r=Math.max(0,Math.round(t.invert(s))),l=Math.min(n.length-1,Math.round(t.invert(o)));if(r===l){Z();return}W.value={startIdx:r,endIdx:l},xt(r,l,n),Q(r,l,n),Tt(r,l,n)}function xt(e,t,n){const s=n[e],o=n[t],r=n.slice(e,t+1);let l=null,i=null;r.forEach(d=>{const f=$.find(b=>b.date===d.date)||$.reduce((b,p)=>{const R=new Date(p.date),wt=new Date(d.date);return R<=wt?p:b},$[0]);f&&f.temp!==null&&((l===null||f.temp<l)&&(l=f.temp),(i===null||f.temp>i)&&(i=f.temp))}),v.value={startDate:s.date,endDate:o.date,startTroops:s.survivors,endTroops:o.survivors,minTemp:l,maxTemp:i,startIdx:e,endIdx:t}}function Z(){v.value=null,W.value=null,M&&M.clearLayers(),A.advance.forEach(e=>e.segment.setStyle({opacity:.8})),A.retreat.forEach(e=>e.segment.setStyle({opacity:.9})),h&&(h.select(".troops-highlight").attr("display","none"),h.select(".troops-brush").call(nt().move,null)),m&&m.select(".temp-highlight").attr("display","none")}function Q(e,t,n){if(!M)return;M.clearLayers(),A.advance.forEach(o=>{o.index>=e&&o.index<t?o.segment.setStyle({opacity:1}):o.segment.setStyle({opacity:.2})}),D.length-1,A.retreat.forEach(o=>{const r=o.index;r>=e&&r<t?o.segment.setStyle({opacity:1}):o.segment.setStyle({opacity:.2})});const s=[];for(let o=e;o<=t&&o<n.length;o++)s.push([n[o].lat,n[o].lon]);s.length>1&&(g.polyline(s,{color:"#FFD700",weight:6,opacity:.8,lineCap:"round"}).addTo(M),g.circleMarker(s[0],{radius:8,fillColor:"#00FF00",color:"#fff",weight:2,fillOpacity:1}).addTo(M),g.circleMarker(s[s.length-1],{radius:8,fillColor:"#FF4444",color:"#fff",weight:2,fillOpacity:1}).addTo(M))}function Tt(e,t,n){if(!m)return;const s=P.value,o=s.clientWidth,r=s.clientHeight,l={top:10,right:30,bottom:25,left:50},i=B().domain([24,38]).range([l.left,o-l.right]),d=n[e].lon,f=n[t].lon,b=i(Math.min(d,f)),p=i(Math.max(d,f));m.select(".temp-highlight").attr("x",b).attr("y",l.top).attr("width",Math.max(p-b,4)).attr("height",r-l.top-l.bottom).attr("display","block")}return Ct(y,()=>{J(),j(),O()}),Dt(()=>{ct(),setTimeout(()=>{vt(),ht()},100)}),Mt(()=>{L&&clearInterval(L),_&&_.remove()}),(e,t)=>{var s,o,r,l;const n=St("router-link");return w(),T("div",Pt,[a("header",Ht,[a("div",Vt,[a("div",Wt,c(k(E.value.troops)),1),t[4]||(t[4]=a("div",{class:"stat-label"},"å½“å‰å…µåŠ›",-1))]),a("div",jt,[a("div",Ot,"-"+c(k(422e3-E.value.troops)),1),t[5]||(t[5]=a("div",{class:"stat-label"},"ç´¯è®¡æŸå¤±",-1))]),a("div",Zt,[a("div",{class:tt(["stat-value",{"highlight-cold":E.value.temp<0}])},c(E.value.temp!==null?E.value.temp+"Â°C":"--"),3),t[6]||(t[6]=a("div",{class:"stat-label"},"æ¸©åº¦",-1))]),a("div",Gt,[a("div",Ut,c(E.value.day),1),t[7]||(t[7]=a("div",{class:"stat-label"},"ç¬¬Nå¤©",-1))]),a("div",Xt,[a("div",qt,c(E.value.phase),1),t[8]||(t[8]=a("div",{class:"stat-label"},"é˜¶æ®µ",-1))]),Y(n,{to:"/visualization",class:"nav-link"},{default:et(()=>[...t[9]||(t[9]=[G("â† è¿”å›å™äº‹ç‰ˆ",-1)])]),_:1})]),a("div",Jt,[a("aside",Kt,[t[10]||(t[10]=a("div",{class:"panel-title"},"å…µåŠ›å˜åŒ–",-1)),a("div",{class:"troops-chart",ref_key:"troopsChartRef",ref:V},null,512)]),a("main",Qt,[a("div",{id:"dashboard-map",ref_key:"mapRef",ref:X},null,512),C.value?(w(),T("div",{key:0,class:"hover-card",style:Bt({left:C.value.x+"px",top:C.value.y+"px"})},[a("div",Yt,c(C.value.city||C.value.event||"è¡Œå†›ä¸­"),1),a("div",te,c(C.value.date),1),a("div",ee,"å…µåŠ›: "+c(k(C.value.troops)),1),C.value.temp!==null?(w(),T("div",ae,"æ¸©åº¦: "+c(C.value.temp)+"Â°C",1)):F("",!0)],4)):F("",!0)]),a("aside",se,[v.value?(w(),T("div",oe,[a("div",{class:"panel-title"},[t[11]||(t[11]=G(" é€‰åŒºç»Ÿè®¡ ",-1)),a("button",{class:"clear-selection-btn",onClick:Z},"æ¸…é™¤")]),a("div",ne,[a("div",le,[t[12]||(t[12]=a("span",{class:"label"},"æ—¶é—´èŒƒå›´",-1)),a("span",re,c(v.value.startDate)+" ~ "+c(v.value.endDate),1)]),a("div",ie,[t[13]||(t[13]=a("span",{class:"label"},"èµ·å§‹å…µåŠ›",-1)),a("span",ce,c(k(v.value.startTroops)),1)]),a("div",de,[t[14]||(t[14]=a("span",{class:"label"},"ç»“æŸå…µåŠ›",-1)),a("span",ue,c(k(v.value.endTroops)),1)]),a("div",pe,[t[15]||(t[15]=a("span",{class:"label"},"å…µåŠ›æŸå¤±",-1)),a("span",ve,"-"+c(k(v.value.startTroops-v.value.endTroops)),1)]),a("div",he,[t[16]||(t[16]=a("span",{class:"label"},"æŸå¤±ç‡",-1)),a("span",me,c(((v.value.startTroops-v.value.endTroops)/v.value.startTroops*100).toFixed(1))+"%",1)]),v.value.minTemp!==null?(w(),T("div",fe,[t[17]||(t[17]=a("span",{class:"label"},"æ¸©åº¦èŒƒå›´",-1)),a("span",ge,c(v.value.minTemp)+"Â°C ~ "+c(v.value.maxTemp)+"Â°C",1)])):F("",!0)])])):F("",!0),t[18]||(t[18]=a("div",{class:"panel-title"},"å…³é”®æˆ˜å½¹",-1)),a("div",ye,[(w(!0),T(At,null,Et(rt.value,i=>{var d,f;return w(),T("div",{key:i.id,class:tt(["battle-item",{active:((d=u.value)==null?void 0:d.id)===i.id,[i.phase]:!0}]),onClick:b=>K(i),onMouseenter:b=>yt(i),onMouseleave:t[0]||(t[0]=b=>_t())},[a("div",ke,c(q(i.type)),1),a("div",be,[a("div",xe,c(i.title),1),a("div",Te,c(i.date),1)]),a("div",we,c(k(((f=i.stats)==null?void 0:f.frenchTroops)||0)),1)],42,_e)}),128))])])]),a("footer",Ce,[a("div",{class:"temp-chart",ref_key:"tempChartRef",ref:P},null,512),a("div",De,[a("button",{class:"control-btn",onClick:mt},c(z.value?"â¸":"â–¶"),1),a("button",{class:"control-btn",onClick:ft},"â®"),Ft(a("input",{type:"range",class:"timeline-slider",min:0,max:S.value.length-1,"onUpdate:modelValue":t[1]||(t[1]=i=>y.value=i),onInput:gt},null,40,Me),[[$t,y.value]]),a("span",Se,c(it.value),1)])]),u.value?(w(),T("div",{key:0,class:"battle-modal",onClick:t[3]||(t[3]=zt(i=>u.value=null,["self"]))},[a("div",Be,[a("button",{class:"modal-close",onClick:t[2]||(t[2]=i=>u.value=null)},"Ã—"),a("h2",null,c(u.value.title),1),a("p",Ae,c(u.value.titleEn)+" | "+c(u.value.date),1),a("p",Ee,c(u.value.overview),1),a("div",Fe,[a("div",$e,[t[19]||(t[19]=a("span",{class:"stat-label"},"æ³•å†›å…µåŠ›",-1)),a("span",ze,c(k(((s=u.value.stats)==null?void 0:s.frenchTroops)||0)),1)]),a("div",Le,[t[20]||(t[20]=a("span",{class:"stat-label"},"ä¿„å†›å…µåŠ›",-1)),a("span",Ie,c(k(((o=u.value.stats)==null?void 0:o.russianTroops)||0)),1)]),(r=u.value.stats)!=null&&r.frenchCasualties?(w(),T("div",Re,[t[21]||(t[21]=a("span",{class:"stat-label"},"æ³•å†›ä¼¤äº¡",-1)),a("span",Ne,c(k(u.value.stats.frenchCasualties)),1)])):F("",!0),(l=u.value.stats)!=null&&l.russianCasualties?(w(),T("div",Pe,[t[22]||(t[22]=a("span",{class:"stat-label"},"ä¿„å†›ä¼¤äº¡",-1)),a("span",He,c(k(u.value.stats.russianCasualties)),1)])):F("",!0)]),Y(n,{to:`/battle/${u.value.id}`,class:"modal-detail-link"},{default:et(()=>[...t[23]||(t[23]=[G(" æŸ¥çœ‹è¯¦ç»†ä»‹ç» â†’ ",-1)])]),_:1},8,["to"])])])):F("",!0)])}}},qe=Nt(Ve,[["__scopeId","data-v-1a40075a"]]);export{qe as default};
